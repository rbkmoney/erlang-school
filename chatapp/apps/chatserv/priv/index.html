<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <title>Websocket client</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <script type="text/javascript">
      var websocket;

      $(document).ready(init);

      function init() {
          $('#server').val("ws://" + window.location.host + "/ws");
          if(!("WebSocket" in window)){
              $('#status').append('<p><span style="color: red;">websockets are not supported </span></p>');
              $("#navigation").hide();
          } else {
              $('#status').append('<p><span style="color: green;">websockets are supported </span></p>');
              connect();
          };
              $("#connected").hide();
              $("#content").hide();
      };

      function connect()
      {
          wsHost = $("#server").val()
          websocket = new WebSocket(wsHost);
          showScreen('<b>Connecting to: ' +  wsHost + '</b>');
          websocket.onopen = function(evt) { onOpen(evt) };
          websocket.onclose = function(evt) { onClose(evt) };
          websocket.onmessage = function(evt) { onMessage(evt) };
          websocket.onerror = function(evt) { onError(evt) };
      };

      function disconnect() {
          websocket.close();
      };

      function toggle_connection(){
          if(websocket.readyState == websocket.OPEN){
              disconnect();
          } else {
              connect();
          };
      };

      function getRooms() {
          if(websocket.readyState == websocket.OPEN){
              req = "{\"type\":\"get_rooms\"}";
              websocket.send(req);
              showScreen('sending: ' + req);
          } else {
               showScreen('websocket is not connected');
          };
      };

      function joinRoom() {
          if(websocket.readyState == websocket.OPEN){
              room = $("#req_room").val();
              req = "{\"type\":\"join_room\", \"room_id\":"+room+"}";
              websocket.send(req);
              showScreen('sending: ' + req);
          } else {
               showScreen('websocket is not connected');
          };
      };

      function setName() {
          if(websocket.readyState == websocket.OPEN){
              room = $("#req_room").val();
              txt = $("#req_content").val();
              req = "{\"type\":\"set_name\", \"room_id\":"+room+", \"content\":\""+txt+"\"}";
              websocket.send(req);
              showScreen('sending: ' + req);
          } else {
               showScreen('websocket is not connected');
          };
      };

      function sendMessage() {
          if(websocket.readyState == websocket.OPEN){
              room = $("#req_room").val();
              txt = $("#req_content").val();
              req = "{\"type\":\"send_message\", \"room_id\":"+room+", \"content\":\""+txt+"\"}";
              websocket.send(req);
              showScreen('sending: ' + req);
          } else {
               showScreen('websocket is not connected');
          };
      };

      function onOpen(evt) {
          showScreen('<span style="color: green;">CONNECTED </span>');
          $("#connected").fadeIn('slow');
          $("#content").fadeIn('slow');
      };

      function onClose(evt) {
          showScreen('<span style="color: red;">DISCONNECTED </span>');
      };

      function onMessage(evt) {
          showScreen('<span style="color: blue;">RESPONSE: ' + evt.data+ '</span>');
      };

      function onError(evt) {
          showScreen('<span style="color: red;">ERROR: ' + evt.data+ '</span>');
      };

      function showScreen(txt) {
          $('#output').prepend('<p>' + txt + '</p>');
      };

      function clearScreen()
      {
          $('#output').html("");
      };
    </script>
</head>

<body>
<div id="header">
    <h1>Websocket client</h1>
    <div id="status"></div>
</div>


<div id="navigation">

    <p id="connecting">
        <input type='text' id="server" value=""/>
        <button type="button" onclick="toggle_connection()">connection</button>
    </p>

    <div id="connected">
        <p>
            RoomId:<br><input type="number" id="req_room"/><br>
            Content:<br><textarea type='text' id="req_content" style="width:50%;height:200px;"></textarea><br>
            <button type="button" onclick="getRooms();">get_rooms</button>
            <button type="button" onclick="joinRoom();">join_room</button>
            <button type="button" onclick="setName();">set_name</button>
            <button type="button" onclick="sendMessage();">send_message</button>
        </p>
    </div>

    <div id="content">
        <button id="clear" onclick="clearScreen()" >Clear text</button>
        <div id="output"></div>
    </div>

</div>
</body>
</html>